---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
---

<Layout
  title="The Reluctant Winner | Sharp Sports Betting Education"
  description="Sharp betting education for the 0.1% who think in probabilities. No picks for sale. No affiliate links."
  image="https://reluctantwinner.com/hero-image.jpg"
>
  <Header />

  <main>
    <!-- Hero Section with Email Capture -->
    <section class="relative bg-white dark:bg-gray-900 overflow-hidden py-24 md:py-32 transition-colors">
      <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-playfair font-bold text-dark-gray dark:text-gray-100 mb-6 leading-tight">
          Don't Gamble. But If You Must, Win Reluctantly.
        </h1>
        <p class="text-xl md:text-2xl text-light-gray dark:text-gray-400 mb-12 leading-relaxed">
          Sharp betting education for the 0.1% who think in probabilities.
        </p>

        <!-- Email Capture Form -->
        <div id="subscribe" class="max-w-md mx-auto">
          <form id="newsletter-form" class="flex flex-col sm:flex-row gap-3">
            <input
              type="email"
              id="email-input"
              placeholder="your@email.com"
              required
              class="flex-1 px-4 py-3 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-dark-gray dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-500 transition-colors"
            />
            <button
              type="submit"
              class="px-6 py-3 bg-primary dark:bg-blue-600 text-white font-semibold rounded-md hover:bg-opacity-90 transition-colors whitespace-nowrap"
            >
              Subscribe
            </button>
          </form>
          <div id="form-message" class="mt-4 text-sm"></div>
        </div>
      </div>
    </section>

    <!-- About Jon Section -->
    <section class="py-24 bg-off-white dark:bg-gray-800 transition-colors">
      <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-playfair font-bold text-dark-gray dark:text-gray-100 mb-6">
            About Jon
          </h2>
        </div>

        <div class="prose prose-lg dark:prose-invert max-w-none">
          <p class="text-xl text-gray-700 dark:text-gray-300 mb-6 leading-relaxed">
            I've been a winning sports bettor and poker player for over a decade. Banned from enough sportsbooks to know I'm doing something right.
          </p>

          <p class="text-lg text-gray-600 dark:text-gray-400 mb-6 leading-relaxed">
            I don't sell picks. I don't push affiliate links. I'm not here to glamorize gambling or sell you a dream.
          </p>

          <p class="text-lg text-gray-600 dark:text-gray-400 mb-8 leading-relaxed">
            This site exists to teach the rare few who are wired for probabilistic thinking. If that's you, welcome. If not, you should probably leave.
          </p>

          <div class="text-center">
            <a href="/about" class="text-primary dark:text-blue-400 hover:underline font-medium">
              Read the full story â†’
            </a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</Layout>

<script>
  const form = document.getElementById('newsletter-form') as HTMLFormElement;
  const emailInput = document.getElementById('email-input') as HTMLInputElement;
  const messageDiv = document.getElementById('form-message') as HTMLDivElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const email = emailInput.value.trim();

    if (!email) {
      messageDiv.textContent = 'Please enter a valid email address.';
      messageDiv.className = 'mt-4 text-sm text-red-600 dark:text-red-400';
      return;
    }

    const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;
    submitButton.disabled = true;
    submitButton.textContent = 'Subscribing...';

    try {
      const response = await fetch(`${import.meta.env.VITE_SUPABASE_URL}/functions/v1/newsletter-subscribe`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${import.meta.env.VITE_SUPABASE_ANON_KEY}`,
        },
        body: JSON.stringify({ email }),
      });

      const data = await response.json();

      if (response.ok) {
        messageDiv.textContent = 'Success! Check your inbox for confirmation.';
        messageDiv.className = 'mt-4 text-sm text-green-600 dark:text-green-400';
        emailInput.value = '';
      } else if (response.status === 409) {
        messageDiv.textContent = 'This email is already subscribed.';
        messageDiv.className = 'mt-4 text-sm text-yellow-600 dark:text-yellow-400';
      } else {
        messageDiv.textContent = data.error || 'Something went wrong. Please try again.';
        messageDiv.className = 'mt-4 text-sm text-red-600 dark:text-red-400';
      }
    } catch (error) {
      messageDiv.textContent = 'Network error. Please try again.';
      messageDiv.className = 'mt-4 text-sm text-red-600 dark:text-red-400';
    } finally {
      submitButton.disabled = false;
      submitButton.textContent = 'Subscribe';
    }
  });
</script>